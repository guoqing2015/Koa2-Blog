{% extends 'blog/base.html' %}
{% block body %}
{# {% include "blog/components/header.html" %} #}
<div id="main">

    <div id="content" role="main">
        <div id="postlist">
            <div class="content_text">

                <div class="title1">
                    <a href="http://www.alloyteam.com/author/heyli/" class="test1 animated tada singleauthor" target="_blank"><img
                            alt="TAT.heyli" src="http://www.alloyteam.com/wp-content/uploads/2015/04/lcxfs1991_avatar_1429622108.png"
                            class="avatar avatar-43 photo" height="43" width="43"></a>

                    <a href="http://www.alloyteam.com/2018/09/13433/" class="blogTitle btitle" rel="bookmark" title="{{post.title}}">
                        {{post.title}}
                    </a>
                    <div class="blogPs"> In <a href="http://www.alloyteam.com/webdevelop/" rel="category tag">Web开发</a>
                        on 2018年09月24日 by <a href="http://www.alloyteam.com/author/heyli/" title="由TAT.heyli发布" rel="author">TAT.heyli</a>
                        view: 702 </div>
                    <span class="comments"><a href="http://www.alloyteam.com/2018/09/13433/#respond" class="up">0</a></span>
                </div>
                <!--content_banner_single-->
                <div class="content_banner">



                    <div class="text">
                        <blockquote>
                            <p>
                                李成熙，腾讯高级工程师，专注于性能优化、工程化和小程序服务。<a rel="nofollow" href="https://weibo.com/leehkfs/">微博</a>
                                | <a rel="nofollow" href="https://www.zhihu.com/people/leehey/">知乎</a> | <a rel="nofollow"
                                    href="https://github.com/lcxfs1991">Github</a>
                            </p>
                        </blockquote>
                        <h2>概念回顾</h2>
                        <p>在掘金开发者大会上，在推荐实践那里，我有提到一种云函数的用法，我们可以将相同的一些操作，比如用户管理、支付逻辑，按照业务的相似性，归类到一个云函数里，这样比较方便管理、排查问题以及逻辑的共享。甚至如果你的小程序的后台逻辑不复杂，请求量不是特别大，完全可以在云函数里面做一个单一的微服务，根据路由来处理任务。</p>
                        <p><span id="more-13433"></span></p>
                        <p>用下面三幅图可以概括，我们来回顾一下：</p>
                        <p><a href="https://ask.qcloudimg.com/draft/1011618/rdef4ndpws.png" rel="prettyPhoto[1]"><img
                                    title="" src="https://ask.qcloudimg.com/draft/1011618/rdef4ndpws.png" alt="" class="ls_slideshow_imgs"></a></p>
                        <p>比如这里就是传统的云函数用法，一个云函数处理一个任务，高度解耦。</p>
                        <p><a href="https://ask.qcloudimg.com/draft/1011618/dp4mts7n9e.png" rel="prettyPhoto[1]"><img
                                    title="" src="https://ask.qcloudimg.com/draft/1011618/dp4mts7n9e.png" alt="" class="ls_slideshow_imgs"></a></p>
                        <p>第二幅架构图就是尝试将请求归类，一个云函数处理某一类的请求，比如有专门负责处理用户的，或者专门处理支付的云函数。</p>
                        <p><a href="https://ask.qcloudimg.com/draft/1011618/4775ja12zs.png" rel="prettyPhoto[1]"><img
                                    title="" src="https://ask.qcloudimg.com/draft/1011618/4775ja12zs.png" alt="" class="ls_slideshow_imgs"></a></p>
                        <p>最后一幅图显示这里只有一个云函数，云函数里有一个分派任务的路由管理，将不同的任务分配给不同的本地函数处理。</p>
                        <h2><code>tcb-router</code> 介绍及用法</h2>
                        <p>为了方便大家试用，咱们腾讯云 Tencent Cloud Base 团队开发了 <a rel="nofollow" href="https://github.com/TencentCloudBase/tcb-router">tcb-router</a>，云函数路由管理库方便大家使用。</p>
                        <p>那具体怎么使用 <code>tcb-router</code> 去实现上面提到的架构呢？下面我会逐一举例子。</p>
                        <p><strong>架构一</strong>：一个云函数处理一个任务<br>
                            这种架构下，其实不需要用到 <code>tcb-router</code>，像普通那样写好云函数，然后在小程序端调用就可以了。</p>
                        <ul>
                            <li>云函数</li>
                        </ul>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469af400462887" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 147px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469af400462887-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469af400462887-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469af400462887-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469af400462887-4">4</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469af400462887-5">5</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469af400462887-6">6</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469af400462887-7">7</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469af400462887-8">8</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469af400462887-1"><span
                                                            class="crayon-c">// 函数 router</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469af400462887-2"><span
                                                            class="crayon-v">exports</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">main</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">event</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">context</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469af400462887-3"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469af400462887-4"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">code</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-cn">0</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469af400462887-5"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">message</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'success'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469af400462887-6"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469af400462887-7"><span
                                                            class="crayon-sy">}</span>；</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469af400462887-8">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0018 seconds] -->
                        <p></p>
                        <ul>
                            <li>小程序端</li>
                        </ul>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469b7547142046" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 207px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469b7547142046-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469b7547142046-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469b7547142046-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469b7547142046-4">4</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469b7547142046-5">5</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469b7547142046-6">6</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469b7547142046-7">7</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469b7547142046-8">8</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469b7547142046-9">9</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469b7547142046-10">10</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469b7547142046-11">11</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469b7547142046-12">12</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469b7547142046-1"><span
                                                            class="crayon-v">wx</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">cloud</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">callFunction</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469b7547142046-2"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">name</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'router'</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469b7547142046-3"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">data</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469b7547142046-4"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">name</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'tcb'</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469b7547142046-5"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">company</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'Tencent'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469b7547142046-6"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469b7547142046-7"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">then</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">res</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469b7547142046-8"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">console</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">log</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">res</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469b7547142046-9"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">catch</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">e</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469b7547142046-10"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">console</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">log</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">e</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469b7547142046-11"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469b7547142046-12">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0012 seconds] -->
                        <p></p>
                        <p><strong>架构二</strong>： 按请求给云函数归类<br>
                            此类架构就是将相似的请求归类到同一个云函数处理，比如可以分为用户管理、支付等等的云函数。</p>
                        <ul>
                            <li>云函数</li>
                        </ul>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469ba127870147" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 957px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-4">4</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-5">5</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-6">6</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-7">7</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-8">8</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-9">9</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-10">10</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-11">11</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-12">12</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-13">13</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-14">14</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-15">15</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-16">16</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-17">17</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-18">18</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-19">19</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-20">20</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-21">21</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-22">22</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-23">23</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-24">24</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-25">25</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-26">26</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-27">27</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-28">28</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-29">29</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-30">30</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-31">31</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-32">32</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-33">33</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-34">34</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-35">35</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-36">36</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-37">37</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-38">38</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-39">39</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-40">40</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-41">41</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-42">42</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-43">43</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-44">44</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-45">45</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-46">46</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-47">47</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-48">48</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-49">49</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-50">50</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-51">51</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-52">52</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-53">53</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-54">54</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-55">55</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-56">56</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-57">57</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-58">58</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-59">59</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-60">60</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-61">61</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469ba127870147-62">62</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-1"><span
                                                            class="crayon-c">// 函数 user</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-2"><span
                                                            class="crayon-m">const</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">TcbRouter</span><span class="crayon-h">
                                                        </span><span class="crayon-o">=</span><span class="crayon-h">
                                                        </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span
                                                            class="crayon-s">'tcb-router'</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-3">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-4"><span
                                                            class="crayon-v">exports</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">main</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">event</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">context</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-5"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">const</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">app</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-h"> </span><span class="crayon-r">new</span><span
                                                            class="crayon-h"> </span><span class="crayon-e">TcbRouter</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">{</span><span
                                                            class="crayon-h"> </span><span class="crayon-i">event</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-6">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-7"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">router</span><span
                                                            class="crayon-sy">(</span><span class="crayon-s">'register'</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-8"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-9"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-10"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-11"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-12"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">ctx</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">body</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-13"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">code</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-cn">0</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-14"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">message</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'register
                                                            success'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-15"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-16"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-17">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-18"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">router</span><span
                                                            class="crayon-sy">(</span><span class="crayon-s">'login'</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-19"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-20"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-21"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-22"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-23"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">ctx</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">body</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-24"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">code</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-cn">0</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-25"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">message</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'login
                                                            success'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-26"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-27"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-28">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-29"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">app</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">serve</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-30"><span
                                                            class="crayon-sy">}</span>；</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-31">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-32"><span
                                                            class="crayon-c">// 函数 pay</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-33"><span
                                                            class="crayon-m">const</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">TcbRouter</span><span class="crayon-h">
                                                        </span><span class="crayon-o">=</span><span class="crayon-h">
                                                        </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span
                                                            class="crayon-s">'tcb-router'</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-34">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-35"><span
                                                            class="crayon-v">exports</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">main</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">event</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">context</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-36"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">const</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">app</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-h"> </span><span class="crayon-r">new</span><span
                                                            class="crayon-h"> </span><span class="crayon-e">TcbRouter</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">{</span><span
                                                            class="crayon-h"> </span><span class="crayon-i">event</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-37">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-38"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">router</span><span
                                                            class="crayon-sy">(</span><span class="crayon-s">'makeOrder'</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-39"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-40"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-41"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-42"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-43"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">ctx</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">body</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-44"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">code</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-cn">0</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-45"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">message</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'make order
                                                            success'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-46"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-47"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-48">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-49"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">router</span><span
                                                            class="crayon-sy">(</span><span class="crayon-s">'pay'</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-50"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-51"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-52"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-53"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-54"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">ctx</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">body</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-55"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">code</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-cn">0</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-56"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">message</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'pay
                                                            success'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-57"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-58"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-59">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-60"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">app</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">serve</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-61"><span
                                                            class="crayon-sy">}</span>；</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469ba127870147-62">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0065 seconds] -->
                        <p></p>
                        <ul>
                            <li>小程序端</li>
                        </ul>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469bd611158369" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 447px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-4">4</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-5">5</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-6">6</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-7">7</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-8">8</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-9">9</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-10">10</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-11">11</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-12">12</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-13">13</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-14">14</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-15">15</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-16">16</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-17">17</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-18">18</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-19">19</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-20">20</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-21">21</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-22">22</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-23">23</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-24">24</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-25">25</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-26">26</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-27">27</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469bd611158369-28">28</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-1"><span
                                                            class="crayon-c">// 注册用户</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-2"><span
                                                            class="crayon-v">wx</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">cloud</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">callFunction</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-3"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">name</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'user'</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-4"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">data</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-5"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">$</span><span class="crayon-v">url</span><span
                                                            class="crayon-o">:</span><span class="crayon-h"> </span><span
                                                            class="crayon-s">'register'</span><span class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-6"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">name</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'tcb'</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-7"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">password</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'09876'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-8"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-9"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">then</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">res</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-10"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">console</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">log</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">res</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-11"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">catch</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">e</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-12"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">console</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">log</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">e</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-13"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-14">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-15"><span
                                                            class="crayon-c">// 下单商品</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-16"><span
                                                            class="crayon-v">wx</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">cloud</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">callFunction</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-17"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">name</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'pay'</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-18"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">data</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-19"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">$</span><span class="crayon-v">url</span><span
                                                            class="crayon-o">:</span><span class="crayon-h"> </span><span
                                                            class="crayon-s">'makeOrder'</span><span class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-20"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">id</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'xxxx'</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-21"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">amount</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'3'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-22"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-23"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">then</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">res</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-24"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">console</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">log</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">res</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-25"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">catch</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">e</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-26"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">console</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">log</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">e</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-27"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469bd611158369-28">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0027 seconds] -->
                        <p></p>
                        <p><strong>架构三：</strong> 由一个云函数处理所有服务</p>
                        <ul>
                            <li>云函数</li>
                        </ul>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469c0728123392" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 822px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-4">4</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-5">5</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-6">6</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-7">7</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-8">8</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-9">9</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-10">10</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-11">11</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-12">12</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-13">13</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-14">14</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-15">15</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-16">16</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-17">17</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-18">18</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-19">19</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-20">20</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-21">21</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-22">22</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-23">23</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-24">24</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-25">25</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-26">26</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-27">27</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-28">28</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-29">29</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-30">30</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-31">31</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-32">32</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-33">33</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-34">34</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-35">35</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-36">36</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-37">37</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-38">38</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-39">39</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-40">40</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-41">41</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-42">42</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-43">43</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-44">44</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-45">45</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-46">46</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-47">47</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-48">48</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-49">49</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-50">50</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-51">51</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-52">52</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c0728123392-53">53</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-1"><span
                                                            class="crayon-c">// 函数 router</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-2"><span
                                                            class="crayon-m">const</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">TcbRouter</span><span class="crayon-h">
                                                        </span><span class="crayon-o">=</span><span class="crayon-h">
                                                        </span><span class="crayon-e">require</span><span class="crayon-sy">(</span><span
                                                            class="crayon-s">'tcb-router'</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-3">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-4"><span
                                                            class="crayon-v">exports</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">main</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">event</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">context</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-5"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">const</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">app</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-h"> </span><span class="crayon-r">new</span><span
                                                            class="crayon-h"> </span><span class="crayon-e">TcbRouter</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">{</span><span
                                                            class="crayon-h"> </span><span class="crayon-i">event</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-6">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-7"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">router</span><span
                                                            class="crayon-sy">(</span><span class="crayon-s">'user/register'</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-8"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-9"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-10"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-11"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-12"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">ctx</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">body</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-13"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">code</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-cn">0</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-14"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">message</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'register
                                                            success'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-15"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-16"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-17">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-18"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">router</span><span
                                                            class="crayon-sy">(</span><span class="crayon-s">'user/login'</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-19"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-20"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-21"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-22"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-23"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">ctx</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">body</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-24"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">code</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-cn">0</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-25"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">message</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'login
                                                            success'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-26"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-27"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-28">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-29"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">router</span><span
                                                            class="crayon-sy">(</span><span class="crayon-s">'pay/makeOrder'</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-30"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-31"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-32"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-33"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-34"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">ctx</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">body</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-35"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">code</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-cn">0</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-36"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">message</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'make order
                                                            success'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-37"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-38"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-39">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-40"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">app</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">router</span><span
                                                            class="crayon-sy">(</span><span class="crayon-s">'pay/pay'</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-41"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-42"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-43"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">await </span><span class="crayon-e">next</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-44"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-45"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">ctx</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">body</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-46"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">code</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-cn">0</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-47"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">message</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'pay
                                                            success'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-48"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-49"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-50">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-51"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">app</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">serve</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-52"><span
                                                            class="crayon-sy">}</span>；</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c0728123392-53">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0059 seconds] -->
                        <p></p>
                        <ul>
                            <li>小程序端</li>
                        </ul>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469c3409047618" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 447px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-4">4</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-5">5</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-6">6</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-7">7</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-8">8</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-9">9</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-10">10</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-11">11</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-12">12</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-13">13</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-14">14</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-15">15</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-16">16</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-17">17</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-18">18</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-19">19</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-20">20</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-21">21</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-22">22</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-23">23</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-24">24</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-25">25</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-26">26</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-27">27</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c3409047618-28">28</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-1"><span
                                                            class="crayon-c">// 注册用户</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-2"><span
                                                            class="crayon-v">wx</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">cloud</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">callFunction</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-3"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">name</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'router'</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-4"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">data</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-5"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">$</span><span class="crayon-v">url</span><span
                                                            class="crayon-o">:</span><span class="crayon-h"> </span><span
                                                            class="crayon-s">'user/register'</span><span class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-6"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">name</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'tcb'</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-7"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">password</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'09876'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-8"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-9"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">then</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">res</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-10"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">console</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">log</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">res</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-11"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">catch</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">e</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-12"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">console</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">log</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">e</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-13"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-14">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-15"><span
                                                            class="crayon-c">// 下单商品</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-16"><span
                                                            class="crayon-v">wx</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">cloud</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">callFunction</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-17"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">name</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'router'</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-18"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">data</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-19"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">$</span><span class="crayon-v">url</span><span
                                                            class="crayon-o">:</span><span class="crayon-h"> </span><span
                                                            class="crayon-s">'pay/makeOrder'</span><span class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-20"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">id</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'xxxx'</span><span
                                                            class="crayon-sy">,</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-21"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">amount</span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-s">'3'</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-22"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-23"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">then</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">res</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-24"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">console</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">log</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">res</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-25"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">catch</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">e</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-26"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">console</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">log</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">e</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-27"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c3409047618-28">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0025 seconds] -->
                        <p></p>
                        <h2>借鉴 Koa2 的中间件机制实现云函数的路由管理</h2>
                        <p>小程序·云开发的云函数目前更推荐 <code>async/await</code> 的玩法来处理异步操作，因此这里也参考了同样是基于 <code>async/await</code>
                            的 Koa2 的中间件实现机制。</p>
                        <p>从上面的一些例子我们可以看出，主要是通过 <code>use</code> 和 <code>router</code> 两种方法传入路由以及相关处理的中间件。</p>
                        <p><code>use</code> 只能传入一个中间件，路由也只能是字符串，通常用于 use 一些所有路由都得使用的中间件</p>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469c6363014814" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 162px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c6363014814-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c6363014814-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c6363014814-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c6363014814-4">4</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c6363014814-5">5</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c6363014814-6">6</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c6363014814-7">7</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c6363014814-8">8</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c6363014814-9">9</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c6363014814-1"><span
                                                            class="crayon-c">// 不写路由表示该中间件应用于所有的路由</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c6363014814-2"><span
                                                            class="crayon-v">app</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">use</span><span class="crayon-sy">(</span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c6363014814-3">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c6363014814-4"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c6363014814-5">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c6363014814-6"><span
                                                            class="crayon-v">app</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">use</span><span class="crayon-sy">(</span><span
                                                            class="crayon-s">'router'</span><span class="crayon-sy">,</span><span
                                                            class="crayon-h"> </span><span class="crayon-e">async</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">ctx</span><span class="crayon-sy">,</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">next</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c6363014814-7">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c6363014814-8"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c6363014814-9">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0008 seconds] -->
                        <p></p>
                        <p><code>router</code> 可以传一个或多个中间件，路由也可以传入一个或者多个。</p>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469c9204267031" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 207px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c9204267031-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c9204267031-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c9204267031-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c9204267031-4">4</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c9204267031-5">5</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c9204267031-6">6</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c9204267031-7">7</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c9204267031-8">8</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c9204267031-9">9</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c9204267031-10">10</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c9204267031-11">11</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469c9204267031-12">12</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c9204267031-1"><span
                                                            class="crayon-v">app</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">router</span><span class="crayon-sy">(</span><span
                                                            class="crayon-s">'router'</span><span class="crayon-sy">,</span><span
                                                            class="crayon-h"> </span><span class="crayon-e">async</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">ctx</span><span class="crayon-sy">,</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">next</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c9204267031-2">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c9204267031-3"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c9204267031-4">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c9204267031-5"><span
                                                            class="crayon-v">app</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">router</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">[</span><span class="crayon-s">'router'</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-s">'timer'</span><span class="crayon-sy">]</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c9204267031-6"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">await
                                                        </span><span class="crayon-e">next</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c9204267031-7"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">,</span><span
                                                            class="crayon-h"> </span><span class="crayon-e">async</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">ctx</span><span class="crayon-sy">,</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">next</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c9204267031-8"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">await
                                                        </span><span class="crayon-e">next</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c9204267031-9"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">,</span><span
                                                            class="crayon-h"> </span><span class="crayon-e">async</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">ctx</span><span class="crayon-sy">,</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">next</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c9204267031-10">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c9204267031-11"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469c9204267031-12">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0013 seconds] -->
                        <p></p>
                        <p>不过，无论是 <code>use</code> 还是 <code>router</code>，都只是将路由和中间件信息，通过 <code>_addMiddleware</code> 和
                            <code>_addRoute</code> 两个方法，录入到 <code>_routerMiddlewares</code> 该对象中，用于后续调用 <code>serve</code>
                            的时候，层层去执行中间件。</p>
                        <p>最重要的运行中间件逻辑，则是在 <code>serve</code> 和 <code>compose</code> 两个方法里。</p>
                        <p><code>serve</code> 里主要的作用是做路由的匹配以及将中间件组合好之后，通过 <code>compose</code>
                            进行下一步的操作。比如以下这段节选的代码，其实是将匹配到的路由的中间件，以及 <code>*</code> 这个通配路由的中间件合并到一起，最后依次执行。</p>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469cb905829525" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 117px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cb905829525-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cb905829525-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cb905829525-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cb905829525-4">4</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cb905829525-5">5</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cb905829525-6">6</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cb905829525-1"><span
                                                            class="crayon-e">let </span><span class="crayon-v">middlewares</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">_routerMiddlewares</span><span class="crayon-sy">[</span><span
                                                            class="crayon-v">url</span><span class="crayon-sy">]</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">?</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">_routerMiddlewares</span><span class="crayon-sy">[</span><span
                                                            class="crayon-v">url</span><span class="crayon-sy">]</span><span
                                                            class="crayon-sy">.</span><span class="crayon-v">middlewares</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">:</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">[</span><span
                                                            class="crayon-sy">]</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cb905829525-2"><span
                                                            class="crayon-c">// put * path middlewares on the queue
                                                            head</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cb905829525-3"><span
                                                            class="crayon-st">if</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">_routerMiddlewares</span><span
                                                            class="crayon-sy">[</span><span class="crayon-s">'*'</span><span
                                                            class="crayon-sy">]</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cb905829525-4"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">middlewares</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">[</span><span
                                                            class="crayon-sy">]</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">concat</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">_routerMiddlewares</span><span class="crayon-sy">[</span><span
                                                            class="crayon-s">'*'</span><span class="crayon-sy">]</span><span
                                                            class="crayon-sy">.</span><span class="crayon-v">middlewares</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">middlewares</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cb905829525-5"><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cb905829525-6">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0010 seconds] -->
                        <p></p>
                        <p>组合好中间件后，执行这一段，将中间件 <code>compose</code> 后并返回一个函数，传入上下文 <code>this</code> 后，最后将 <code>this.body</code>
                            的值 <code>resolve</code>，即一般在最后一个中间件里，通过对 <code>ctx.body</code> 的赋值，实现云函数的对小程序端的返回：</p>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469cf657652568" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 147px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cf657652568-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cf657652568-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cf657652568-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cf657652568-4">4</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cf657652568-5">5</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cf657652568-6">6</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cf657652568-7">7</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469cf657652568-8">8</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cf657652568-1"><span
                                                            class="crayon-m">const</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">fn</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">compose</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">middlewares</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cf657652568-2">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cf657652568-3"><span
                                                            class="crayon-st">return</span><span class="crayon-h">
                                                        </span><span class="crayon-r">new</span><span class="crayon-h">
                                                        </span><span class="crayon-e">Promise</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">resolve</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">reject</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cf657652568-4"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">fn</span><span
                                                            class="crayon-sy">(</span><span class="crayon-r">this</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">then</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">res</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cf657652568-5"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">resolve</span><span class="crayon-sy">(</span><span
                                                            class="crayon-r">this</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">body</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cf657652568-6"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">catch</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">reject</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cf657652568-7"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469cf657652568-8">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0010 seconds] -->
                        <p></p>
                        <p>那么 <code>compose</code> 是怎么组合好这些中间件的呢？这里截取部份代码进行分析</p>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469d1881737354" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 657px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-4">4</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-5">5</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-6">6</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-7">7</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-8">8</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-9">9</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-10">10</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-11">11</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-12">12</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-13">13</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-14">14</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-15">15</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-16">16</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-17">17</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-18">18</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-19">19</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-20">20</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-21">21</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-22">22</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-23">23</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-24">24</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-25">25</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-26">26</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-27">27</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-28">28</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-29">29</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-30">30</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-31">31</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-32">32</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-33">33</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-34">34</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-35">35</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-36">36</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-37">37</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-38">38</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-39">39</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-40">40</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-41">41</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d1881737354-42">42</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-1"><span
                                                            class="crayon-t">function</span><span class="crayon-h">
                                                        </span><span class="crayon-e">compose</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">middleware</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-2"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">/**</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-3"><span
                                                            class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp; * ... 其它代码 </span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-4"><span
                                                            class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp; */</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-5"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span
                                                            class="crayon-h"> </span><span class="crayon-t">function</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">context</span><span class="crayon-sy">,</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">next</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-6"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-c">// 这里的 next，如果是在主流程里，一般 next 都是空。</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-7"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">let </span><span class="crayon-v">index</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">-</span><span
                                                            class="crayon-cn">1</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-8">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-9"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-c">// 在这里开始处理处理第一个中间件</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-10"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-st">return</span><span class="crayon-h">
                                                        </span><span class="crayon-e">dispatch</span><span class="crayon-sy">(</span><span
                                                            class="crayon-cn">0</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-11">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-12"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-c">// dispatch 是核心的方法，通过不断地调用 dispatch
                                                            来处理所有的中间件</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-13"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-t">function</span><span class="crayon-h">
                                                        </span><span class="crayon-e">dispatch</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">i</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-14"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-st">if</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">i</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">&lt;=</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">index</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-15"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-st">return</span><span class="crayon-h">
                                                        </span><span class="crayon-v">Promise</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">reject</span><span class="crayon-sy">(</span><span
                                                            class="crayon-r">new</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">Error</span><span class="crayon-sy">(</span><span
                                                            class="crayon-s">'next() called multiple times'</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-16"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-17">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-18"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">index</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">i</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-19">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-20"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-c">// 获取中间件函数</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-21"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">let </span><span class="crayon-v">handler</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">middleware</span><span
                                                            class="crayon-sy">[</span><span class="crayon-v">i</span><span
                                                            class="crayon-sy">]</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-22">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-23"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-c">// 处理完最后一个中间件，返回 Proimse.resolve</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-24"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-st">if</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">i</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">===</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">middleware</span><span
                                                            class="crayon-sy">.</span><span class="crayon-v">length</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-25"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-v">handler</span><span class="crayon-h">
                                                        </span><span class="crayon-o">=</span><span class="crayon-h">
                                                        </span><span class="crayon-v">next</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-26"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-27">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-28"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-st">if</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-o">!</span><span
                                                            class="crayon-v">handler</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-29"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-st">return</span><span class="crayon-h">
                                                        </span><span class="crayon-v">Promise</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">resolve</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-30"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-31">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-32"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-st">try</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-33"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-c">// 在这里不断地调用 dispatch, 同时增加 i 的数值处理中间件</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-34"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-st">return</span><span class="crayon-h">
                                                        </span><span class="crayon-v">Promise</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">resolve</span><span class="crayon-sy">(</span><span
                                                            class="crayon-e">handler</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">context</span><span class="crayon-sy">,</span><span
                                                            class="crayon-h"> </span><span class="crayon-v">dispatch</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">bind</span><span
                                                            class="crayon-sy">(</span><span class="crayon-t">null</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">i</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">+</span><span class="crayon-h"> </span><span
                                                            class="crayon-cn">1</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-35"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-36"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-st">catch</span><span class="crayon-h">
                                                        </span><span class="crayon-sy">(</span><span class="crayon-v">err</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-37"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-st">return</span><span class="crayon-h">
                                                        </span><span class="crayon-v">Promise</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">reject</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">err</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-38"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-39"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-40"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-41"><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d1881737354-42">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0032 seconds] -->
                        <p></p>
                        <p>看完这里的代码，其实有点疑惑，怎么通过 <code>Promise.resolve(handler(xxxx))</code> 这样的代码逻辑可以推进中间件的调用呢？</p>
                        <p>首先，我们知道，<code>handler</code> 其实就是一个 <code>async function</code>，<code>next</code>，就是 <code>dispatch.bind(null,
                                i + 1)</code> 比如这个：</p>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469d4227542742" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 87px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d4227542742-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d4227542742-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d4227542742-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d4227542742-4">4</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d4227542742-1"><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">ctx</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">next</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d4227542742-2"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">await
                                                        </span><span class="crayon-e">next</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d4227542742-3"><span
                                                            class="crayon-sy">}</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d4227542742-4">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0004 seconds] -->
                        <p></p>
                        <p>而我们知道，<code>dispatch</code> 是返回一个 <code>Promise.resolve</code> 或者一个 <code>Promise.reject</code>，因此在
                            <code>async function</code> 里执行 <code>await next()</code>，就相当于触发下一个中间件的调用。</p>
                        <p>当 <code>compose</code> 完成后，还是会返回一个 <code>function (context, next)</code>，于是就走到下面这个逻辑，执行
                            <code>fn</code> 并传入上下文 <code>this</code> 后，再将在中间件中赋值的 <code>this.body</code> <code>resolve</code>
                            出来，最终就成为云函数数要返回的值。</p>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469d7821362071" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 147px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d7821362071-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d7821362071-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d7821362071-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d7821362071-4">4</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d7821362071-5">5</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d7821362071-6">6</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d7821362071-7">7</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469d7821362071-8">8</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d7821362071-1"><span
                                                            class="crayon-m">const</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">fn</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">compose</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">middlewares</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d7821362071-2">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d7821362071-3"><span
                                                            class="crayon-st">return</span><span class="crayon-h">
                                                        </span><span class="crayon-r">new</span><span class="crayon-h">
                                                        </span><span class="crayon-e">Promise</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">resolve</span><span
                                                            class="crayon-sy">,</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">reject</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d7821362071-4"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">fn</span><span
                                                            class="crayon-sy">(</span><span class="crayon-r">this</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">then</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">res</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d7821362071-5"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span
                                                            class="crayon-e">resolve</span><span class="crayon-sy">(</span><span
                                                            class="crayon-r">this</span><span class="crayon-sy">.</span><span
                                                            class="crayon-v">body</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d7821362071-6"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">.</span><span
                                                            class="crayon-st">catch</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">reject</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d7821362071-7"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469d7821362071-8">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0011 seconds] -->
                        <p></p>
                        <p>看到 <code>Promise.resolve</code> 一个 <code>async function</code>，许多人都会很困惑。其实撇除 <code>next</code>
                            这个往下调用中间件的逻辑，我们可以很好地将逻辑简化成下面这段示例：</p>
                        <p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

                        <div id="crayon-5bd90d1e469da129746894" class="crayon-syntax crayon-theme-sublime-text crayon-font-courier-new crayon-os-pc print-yes notranslate"
                            data-settings=" minimize scroll-mouseover" style="margin-top: 1px; margin-bottom: 1px; font-size: 14px !important; line-height: 15px !important; height: 402px;">

                            <div class="crayon-plain-wrap"></div>
                            <div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;">
                                <table class="crayon-table" style="">
                                    <tbody>
                                        <tr class="crayon-row">
                                            <td class="crayon-nums " data-settings="show">
                                                <div class="crayon-nums-content" style="font-size: 14px !important; line-height: 15px !important;">
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-1">1</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-2">2</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-3">3</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-4">4</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-5">5</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-6">6</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-7">7</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-8">8</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-9">9</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-10">10</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-11">11</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-12">12</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-13">13</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-14">14</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-15">15</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-16">16</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-17">17</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-18">18</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-19">19</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-20">20</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-21">21</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-22">22</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-23">23</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-24">24</div>
                                                    <div class="crayon-num" data-line="crayon-5bd90d1e469da129746894-25">25</div>
                                                </div>
                                            </td>
                                            <td class="crayon-code">
                                                <div class="crayon-pre" style="font-size: 14px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-1"><span
                                                            class="crayon-i">let</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">a</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-2"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">console</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">log</span><span
                                                            class="crayon-sy">(</span><span class="crayon-cn">1</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-3"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-4">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-5"><span
                                                            class="crayon-i">let</span><span class="crayon-h"> </span><span
                                                            class="crayon-v">b</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-h"> </span><span
                                                            class="crayon-e">async</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-6"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">console</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">log</span><span
                                                            class="crayon-sy">(</span><span class="crayon-cn">2</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-7">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-8"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span
                                                            class="crayon-h"> </span><span class="crayon-cn">3</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-9"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-10">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-11">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-12"><span
                                                            class="crayon-e">let </span><span class="crayon-v">fn</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-h"> </span><span class="crayon-e">async</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">)</span><span class="crayon-h"> </span><span
                                                            class="crayon-o">=</span><span class="crayon-o">&gt;</span><span
                                                            class="crayon-h"> </span><span class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-13"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-i">await</span><span
                                                            class="crayon-h"> </span><span class="crayon-e">a</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-14"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span
                                                            class="crayon-h"> </span><span class="crayon-e">b</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-15"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-16">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-17"><span
                                                            class="crayon-v">Promise</span><span class="crayon-sy">.</span><span
                                                            class="crayon-e">resolve</span><span class="crayon-sy">(</span><span
                                                            class="crayon-e">fn</span><span class="crayon-sy">(</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">.</span><span class="crayon-st">then</span><span
                                                            class="crayon-sy">(</span><span class="crayon-sy">(</span><span
                                                            class="crayon-v">res</span><span class="crayon-sy">)</span><span
                                                            class="crayon-h"> </span><span class="crayon-o">=</span><span
                                                            class="crayon-o">&gt;</span><span class="crayon-h"> </span><span
                                                            class="crayon-sy">{</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-18"><span
                                                            class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">console</span><span
                                                            class="crayon-sy">.</span><span class="crayon-e">log</span><span
                                                            class="crayon-sy">(</span><span class="crayon-v">res</span><span
                                                            class="crayon-sy">)</span><span class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-19"><span
                                                            class="crayon-sy">}</span><span class="crayon-sy">)</span><span
                                                            class="crayon-sy">;</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-20">&nbsp;</div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-21"><span
                                                            class="crayon-c">// 输出</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-22"><span
                                                            class="crayon-c">// 1</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-23"><span
                                                            class="crayon-c">// 2</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-24"><span
                                                            class="crayon-c">// 3</span></div>
                                                    <div class="crayon-line" id="crayon-5bd90d1e469da129746894-25">&nbsp;</div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- [Format Time: 0.0019 seconds] -->
                        <p></p>

                    </div>

                    <!-- 打赏功能 -->
                    <!-- <div class="paycode-wording">如果你觉得我们Alloyteam团队的博客和开源项目给你带来价值，可以通过捐赏支持我们，有你的支持，我们会做得更好！</div> -->
                    <!-- <a class="helpus" href='javascript:;' title="支持原创文章 & 开源项目，请我们喝杯咖啡吧^_Q"> -->
                    <!-- <div class="paycode"> -->
                    <!-- <div class="wechatpay">微信扫一扫赞赏</div> -->
                    <!-- <div class="alipay">支付宝扫一扫赞赏</div> -->
                    <!-- <br />
                    <img src="images/wechatpaycode.png" />
                    <br /><br />
                    <img src="images/wechatpaycode.png" /> -->
                    <!-- </div> -->
                    <!-- </a> -->
                </div>
                <div class="post-cp">

                    <p class="cp-title">原创文章转载请注明：</p>
                    <p class="cp-text">转载自AlloyTeam：<a href="http://www.alloyteam.com/2018/09/13433/">http://www.alloyteam.com/2018/09/13433/</a></p>
                </div>
                <div class="toolbar">
                    <!-- <a class="helpus" href='javascript:;' title="支持原创文章 & 开源项目，请我们喝杯咖啡吧^_Q">
            <div class="paycode">
                <div>　　如果你觉得我们Alloyteam团队的博客和开源项目给你带来价值，可以通过捐赏支持我们，有你的支持，我们会做得更好！</div>
                <br />
                <div class="wechatpay"></div>
                <br />
                <div class="alipay"></div>
                
            </div>
        </a> -->
                    <a class="helpus2" href="javascript:;">
                        <div class="paycode">
                            <div style="display: -webkit-box;margin: auto;width: 400px;">
                                <div class="wechatpay"></div>
                                <div class="alipay"></div>
                            </div>

                            <!-- <img src="images/wechatpaycode.png" />
                <img src="images/alipaycode.png" / >-->
                            <div>如果你觉得我们Alloyteam团队的博客和开源项目给你带来价值，可以通过捐赏支持我们<br>有你的支持，我们会做得更好！</div>
                        </div>
                    </a>
                </div>
                <div class="bshare-custom icon-medium-plus">
                    <div class="bsPromo bsPromo2"></div><a title="分享到:" href="http://www.bShare.cn/" id="bshare-shareto"
                        class="bshare-more">分享到:</a><a title="分享到QQ空间" class="bshare-qzone"></a><a title="分享到微信" class="bshare-weixin"></a><a
                        title="分享到腾讯微博" class="bshare-qqmb"></a><a title="分享到新浪微博" class="bshare-sinaminiblog"></a><a
                        title="更多平台" class="bshare-more bshare-more-icon more-style-addthis"></a><span class="BSHARE_COUNT bshare-share-count"
                        style="float: none;">0</span>
                </div>
                <script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/buttonLite.js#style=-1&amp;uuid=&amp;pophcol=1&amp;lang=zh"></script>
                <script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/bshareC0.js"></script>
            </div>
            <div id="comments" class="comments">
                <script type="text/javascript">
                    var defaultAuthor = "称呼(必填)";
                    var defaultEmail = "邮箱(不会被公开,必填)";
                    var defaultUrl = "网站";
                    var defaultComment = "评论内容...";

                    function commentform_submit() {
                        if (document.commentform.author.value == '' || document.commentform.author.value ==
                            defaultAuthor) {
                            alert('咳咳...称呼忘填了');
                            document.commentform.author.focus();
                            return;
                        }
                        if (document.commentform.email.value == '' || document.commentform.email.value == defaultEmail) {
                            alert('email...您的email没填');
                            document.commentform.email.focus();
                            return;
                        }
                        if (document.commentform.comment.value == '' || document.commentform.comment.value ==
                            defaultComment) {
                            alert('评论内容在哪？');
                            document.commentform.comment.focus();
                            return;
                        }
                        if (document.commentform.url.value == defaultUrl) document.commentform.url.value = '';
                        // document.commentform.submit();
                    }
                </script>


                <div class="clearfix"></div>


                <div id="respond" class="commentform">
                    <h3>发表评论</h3>
                    <div class="cancel-comment-reply"><a rel="nofollow" id="cancel-comment-reply-link" href="/2018/09/13433/#respond"
                            style="display:none;">点击这里取消回复。</a></div>
                    <form action="http://www.alloyteam.com/wp-comments-post.php" method="post" id="commentform">

                        <p><input type="text" name="author" id="author" value="" size="22" tabindex="1">
                            <label for="author"><small>称呼 (必填)</small></label></p>
                        <p><input type="text" name="email" id="email" value="" size="22" tabindex="2">
                            <label for="email"><small>邮箱 (不会被公开,必填)</small></label></p>
                        <p><input type="text" name="url" id="url" value="" size="22" tabindex="3">
                            <label for="url"><small>网站</small></label></p>
                        <p><textarea name="comment" id="comment" cols="100%" rows="6" tabindex="4" onkeydown="if(event.ctrlKey&amp;&amp;event.keyCode==13){document.getElementById('submit').click();return false};"></textarea>
                            <div id="loading" style="display: none;"> 发送中...</div>
                            <div id="error" style="display: none;">#</div>
                        </p>
                        <p><input name="submit" type="submit" id="submit" tabindex="5" value="提 交"><input type="hidden"
                                name="comment_post_ID" value="13433" id="comment_post_ID">
                            <input type="hidden" name="comment_parent" id="comment_parent" value="0">
                        </p>
                        <p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce"
                                value="cd98f83d8c"></p>
                        <p style="display: none;"></p>
                        <input type="hidden" id="ak_js" name="ak_js" value="1540951327830">
                    </form>

                </div>

            </div>
        </div>
    </div>
</div>
{% endblock %}